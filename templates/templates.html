<!DOCTYPE html>
<html>
<head>
    <title>Archisketch Templates</title>
    <style>
        /* Your existing styles here */
        .template-img {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
        }
        .template {
            margin: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Select a Template</h1>
    <div id="templatesGallery"></div>

    <script>
        // 1. CONFIGURATION - Set these once
        const CONFIG = {
            GITHUB_USER: "Arhyeldee001",
            REPO_NAME: "Archi-Sketch-Templates",
            BRANCH: "main",
            TEMPLATES_FOLDER: "templates"
        };

        // 2. Fetch images using GitHub Contents API
        async function loadTemplates() {
            const gallery = document.getElementById('templatesGallery');
            gallery.innerHTML = '<p>Loading templates...</p>';

            try {
                const apiUrl = `https://api.github.com/repos/${CONFIG.GITHUB_USER}/${CONFIG.REPO_NAME}/contents/${CONFIG.TEMPLATES_FOLDER}?ref=${CONFIG.BRANCH}`;
                
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error(`GitHub API error: ${response.status}`);
                
                const files = await response.json();
                gallery.innerHTML = ''; // Clear loading message

                // 3. Process image files
                files.forEach(file => {
                    if (file.name.match(/\.(jpg|jpeg|png|webp)$/i)) {
                        const rawUrl = `https://raw.githubusercontent.com/${CONFIG.GITHUB_USER}/${CONFIG.REPO_NAME}/${CONFIG.BRANCH}/${CONFIG.TEMPLATES_FOLDER}/${file.name}`;
                        
                        const templateDiv = document.createElement('div');
                        templateDiv.className = 'template';
                        templateDiv.innerHTML = `
                            <img src="${rawUrl}" class="template-img" 
                                 onerror="this.style.display='none'">
                            <button onclick="selectTemplate('${file.name}')">
                                Select ${file.name.replace(/\.[^/.]+$/, "")}
                            </button>
                        `;
                        
                        gallery.appendChild(templateDiv);
                    }
                });

                if (gallery.children.length === 0) {
                    gallery.innerHTML = '<p>No templates found in repository.</p>';
                }

            } catch (error) {
                gallery.innerHTML = `
                    <div class="error">
                        <p>Failed to load templates</p>
                        <small>${error.message}</small>
                        <p>Try <a href="javascript:location.reload()">refreshing</a></p>
                    </div>
                `;
                console.error("Template loading error:", error);
            }
        }

        // 4. Selection handler with URL verification
        function selectTemplate(filename) {
            const rawUrl = `https://raw.githubusercontent.com/${CONFIG.GITHUB_USER}/${CONFIG.REPO_NAME}/${CONFIG.BRANCH}/${CONFIG.TEMPLATES_FOLDER}/${filename}`;
            
            // First verify the image exists
            const tester = new Image();
            tester.onload = function() {
                // Only store URL if image loads successfully
                localStorage.setItem('selectedTemplateUrl', rawUrl);
                window.location.href = '../index.html'; // Adjust path as needed
            };
            tester.onerror = function() {
                alert(`Error: Could not load template "${filename}"`);
                console.error('Failed to load:', rawUrl);
            };
            tester.src = rawUrl;
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', loadTemplates);
    </script>
</body>
</html>
